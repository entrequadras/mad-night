<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mad Night - v1.40</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Press Start 2P', monospace;
            overflow: hidden;
        }
        
        #gameCanvas {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            border: 2px solid #333;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #0f0;
            font-size: 10px;
            text-shadow: 2px 2px 0px #000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="info">Carregando...</div>
    
    <script>
        // MAD NIGHT v1.40 - VERSÃO STANDALONE
        console.log('Mad Night v1.40 - Standalone Version');
        
        // Canvas e contexto
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const info = document.getElementById('info');
        
        // Configurações
        canvas.width = 960 * 2;  // 1920
        canvas.height = 540 * 2; // 1080
        ctx.imageSmoothingEnabled = false;
        
        // Estado do jogo
        const game = {
            currentMap: 0,
            deaths: 0,
            phase: 'infiltration',
            dashUnlocked: false,
            pedalPower: 4,
            maxPedalPower: 4,
            lastRecharge: Date.now()
        };
        
        // Player
        const player = {
            x: 150,
            y: 300,
            width: 56,
            height: 56,
            speed: 3.6,
            direction: 'right',
            isDead: false,
            isDashing: false,
            dashStart: 0,
            dashDuration: 150,
            dashDistance: 60,
            color: '#f00'
        };
        
        // Câmera
        const camera = {
            x: 0,
            y: 0,
            width: 960,
            height: 540,
            zoom: 2
        };
        
        // Inimigos
        const enemies = [];
        
        // Mapa básico
        const map = {
            width: 1920,
            height: 1080,
            name: "Maconhão",
            subtitle: "Tutorial de movimento"
        };
        
        // Input
        const keys = {};
        
        // Inimigo básico
        class Enemy {
            constructor(x, y, type = 'faquinha') {
                this.x = x;
                this.y = y;
                this.width = 46;
                this.height = 46;
                this.speed = 2;
                this.type = type;
                this.color = type === 'faquinha' ? '#808' : '#408';
                this.isDead = false;
                this.direction = 'down';
                this.state = 'patrol';
                this.visionRange = 150;
            }
            
            update() {
                if (this.isDead) return;
                
                // Distância até o player
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                // Perseguir se ver o player
                if (dist < this.visionRange && !player.isDead) {
                    this.state = 'chase';
                    
                    // Mover em direção ao player
                    const angle = Math.atan2(dy, dx);
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;
                    
                    // Matar player se tocar
                    if (dist < 30) {
                        killPlayer();
                    }
                } else {
                    this.state = 'patrol';
                    // Movimento aleatório simples
                    this.x += (Math.random() - 0.5) * 1;
                    this.y += (Math.random() - 0.5) * 1;
                }
                
                // Limitar ao mapa
                this.x = Math.max(0, Math.min(map.width - this.width, this.x));
                this.y = Math.max(0, Math.min(map.height - this.height, this.y));
                
                // Morrer com dash
                if (player.isDashing) {
                    const dashDist = Math.sqrt(
                        Math.pow(player.x - this.x, 2) + 
                        Math.pow(player.y - this.y, 2)
                    );
                    if (dashDist < 40) {
                        this.isDead = true;
                    }
                }
            }
            
            draw(ctx) {
                if (this.isDead) {
                    ctx.fillStyle = '#444';
                } else {
                    ctx.fillStyle = this.state === 'chase' ? '#f0f' : this.color;
                }
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }
        
        // Funções do jogo
        function killPlayer() {
            if (player.isDead) return;
            
            player.isDead = true;
            player.color = '#800';
            game.deaths++;
            
            setTimeout(() => {
                player.isDead = false;
                player.color = '#f00';
                player.x = 150;
                player.y = 300;
                
                if (game.deaths >= 5) {
                    game.deaths = 0;
                    enemies.length = 0;
                    game.dashUnlocked = false;
                    info.textContent = 'Game Over! Recomeçando...';
                }
            }, 2000);
        }
        
        // Update
        function update() {
            if (player.isDead) return;
            
            // Movimento do player
            let dx = 0, dy = 0;
            let moving = false;
            
            if (player.isDashing) {
                // Lógica do dash
                const progress = (Date.now() - player.dashStart) / player.dashDuration;
                if (progress >= 1) {
                    player.isDashing = false;
                } else {
                    const dashSpeed = player.dashDistance / player.dashDuration * 16;
                    switch(player.direction) {
                        case 'up': player.y -= dashSpeed; break;
                        case 'down': player.y += dashSpeed; break;
                        case 'left': player.x -= dashSpeed; break;
                        case 'right': player.x += dashSpeed; break;
                    }
                }
            } else {
                // Movimento normal
                if (keys['ArrowUp']) { 
                    dy = -1; 
                    player.direction = 'up'; 
                    moving = true;
                }
                if (keys['ArrowDown']) { 
                    dy = 1; 
                    player.direction = 'down'; 
                    moving = true;
                }
                if (keys['ArrowLeft']) { 
                    dx = -1; 
                    player.direction = 'left'; 
                    moving = true;
                }
                if (keys['ArrowRight']) { 
                    dx = 1; 
                    player.direction = 'right'; 
                    moving = true;
                }
                
                player.x += dx * player.speed;
                player.y += dy * player.speed;
                
                // Dash (espaço)
                if (keys[' '] && game.dashUnlocked && game.pedalPower > 0 && !player.isDashing) {
                    player.isDashing = true;
                    player.dashStart = Date.now();
                    game.pedalPower--;
                    player.color = '#ff0';
                    
                    setTimeout(() => {
                        player.color = '#f00';
                    }, 150);
                }
            }
            
            // Recarregar pedal power
            if (!moving && Date.now() - game.lastRecharge > 6000 && game.pedalPower < game.maxPedalPower) {
                game.pedalPower++;
                game.lastRecharge = Date.now();
            }
            
            // Limitar ao mapa
            player.x = Math.max(0, Math.min(map.width - player.width, player.x));
            player.y = Math.max(0, Math.min(map.height - player.height, player.y));
            
            // Atualizar câmera
            camera.x = player.x + player.width/2 - camera.width/2;
            camera.y = player.y + player.height/2 - camera.height/2;
            camera.x = Math.max(0, Math.min(map.width - camera.width, camera.x));
            camera.y = Math.max(0, Math.min(map.height - camera.height, camera.y));
            
            // Atualizar inimigos
            enemies.forEach(enemy => enemy.update());
            
            // Remover inimigos mortos após 3 segundos
            enemies.forEach((enemy, index) => {
                if (enemy.isDead && !enemy.removeTime) {
                    enemy.removeTime = Date.now() + 3000;
                }
                if (enemy.removeTime && Date.now() > enemy.removeTime) {
                    enemies.splice(index, 1);
                }
            });
        }
        
        // Draw
        function draw() {
            // Limpar
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Aplicar transformação da câmera
            ctx.save();
            ctx.scale(camera.zoom, camera.zoom);
            ctx.translate(-camera.x, -camera.y);
            
            // Background
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, map.width, map.height);
            
            // Grade (tiles)
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            for (let x = 0; x < map.width; x += 120) {
                for (let y = 0; y < map.height; y += 120) {
                    ctx.strokeRect(x, y, 120, 120);
                }
            }
            
            // Bordas do mapa
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 20;
            ctx.strokeRect(0, 0, map.width, map.height);
            
            // Inimigos
            enemies.forEach(enemy => enemy.draw(ctx));
            
            // Player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Direção do player (pequeno indicador)
            ctx.fillStyle = '#fff';
            switch(player.direction) {
                case 'up': ctx.fillRect(player.x + 23, player.y, 10, 10); break;
                case 'down': ctx.fillRect(player.x + 23, player.y + 46, 10, 10); break;
                case 'left': ctx.fillRect(player.x, player.y + 23, 10, 10); break;
                case 'right': ctx.fillRect(player.x + 46, player.y + 23, 10, 10); break;
            }
            
            ctx.restore();
            
            // UI (sem transformação)
            ctx.fillStyle = '#ff0';
            ctx.font = '20px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillText(map.name, canvas.width/2, 60);
            
            ctx.font = '10px "Press Start 2P"';
            ctx.fillText(map.subtitle, canvas.width/2, 90);
            
            // Info
            ctx.textAlign = 'left';
            ctx.fillStyle = '#fff';
            ctx.fillText(`Mortes: ${game.deaths}/5`, 20, 40);
            ctx.fillText(`Inimigos: ${enemies.filter(e => !e.isDead).length}`, 20, 70);
            
            // Pedal power
            if (game.dashUnlocked) {
                ctx.fillText('Pedal: ', 20, 100);
                for (let i = 0; i < game.maxPedalPower; i++) {
                    ctx.fillStyle = i < game.pedalPower ? '#0f0' : '#333';
                    ctx.fillText('█', 100 + i * 20, 100);
                }
            }
            
            // Mensagem de morte
            if (player.isDead) {
                ctx.fillStyle = '#f00';
                ctx.font = '24px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText(game.deaths < 4 ? "Ah véi, se liga!" : "SIFUDEU", canvas.width/2, canvas.height/2);
            }
        }
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Input
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Debug keys
            if (e.key === 'e' || e.key === 'E') {
                enemies.push(new Enemy(
                    player.x + 200 + Math.random() * 100,
                    player.y + Math.random() * 100,
                    Math.random() > 0.5 ? 'faquinha' : 'morcego'
                ));
                info.textContent = 'Inimigo criado!';
            }
            
            if (e.key === 'd' || e.key === 'D') {
                game.dashUnlocked = !game.dashUnlocked;
                info.textContent = game.dashUnlocked ? 'Dash desbloqueado!' : 'Dash bloqueado';
            }
            
            if (e.key === 'k' || e.key === 'K') {
                killPlayer();
            }
            
            // Prevenir scroll
            if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Inicializar
        function init() {
            console.log('Jogo iniciado!');
            info.innerHTML = 'CONTROLES:<br>' +
                           'Setas = Mover<br>' +
                           'E = Criar inimigo<br>' +
                           'D = Ativar dash<br>' +
                           'Espaço = Dash<br>' +
                           'K = Morrer';
            
            // Criar alguns inimigos iniciais
            enemies.push(new Enemy(500, 300, 'faquinha'));
            enemies.push(new Enemy(800, 500, 'morcego'));
            
            // Iniciar loop
            gameLoop();
        }
        
        // Iniciar quando carregar
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
